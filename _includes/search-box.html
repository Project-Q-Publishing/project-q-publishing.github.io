<div id="search-container">
  <button type="button" id="search-toggle" class="search-toggle" aria-label="Toggle search">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
  </button>
  <div class="search-wrapper">
    <input type="text" id="search-input" placeholder="Search books...">
    <button type="button" id="search-clear" class="search-clear" aria-label="Clear search">&times;</button>
  </div>
  <ul id="results-container"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
var searchContainer = document.getElementById('search-container');
var searchToggle = document.getElementById('search-toggle');
var searchInput = document.getElementById('search-input');
var clearButton = document.getElementById('search-clear');
var resultsContainer = document.getElementById('results-container');

SimpleJekyllSearch({
  searchInput: searchInput,
  resultsContainer: resultsContainer,
  json: '/search.json',
  searchResultTemplate: '<li><a href="{url}"><strong>{title}</strong></a><br><span class="author">by {author}</span><br><span class="description">{description}</span></li>',
  noResultsText: 'No books found',
  limit: 10,
  fuzzy: false
})

// Toggle search box
searchToggle.addEventListener('click', function() {
  searchContainer.classList.add('expanded');
  searchInput.focus();
});

// Show/hide clear button
searchInput.addEventListener('input', function() {
  clearButton.style.display = this.value.length > 0 ? 'inline-block' : 'none';
});

// Clear search
clearButton.addEventListener('click', function() {
  searchInput.value = '';
  resultsContainer.innerHTML = '';
  clearButton.style.display = 'none';
  searchInput.focus();
});

// Collapse search when clicking outside
document.addEventListener('click', function(e) {
  if (!searchContainer.contains(e.target)) {
    if (searchInput.value === '' && resultsContainer.children.length === 0) {
      searchContainer.classList.remove('expanded');
    }
  }
});

// Close on escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && searchContainer.classList.contains('expanded')) {
    if (searchInput.value === '' && resultsContainer.children.length === 0) {
      searchContainer.classList.remove('expanded');
    }
  }
});
</script>
